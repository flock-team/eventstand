<section class="my-page" *ngIf="user$ | async as user">
  <div class="container">
    <div class="my-page__header">
      <div class="my-page__avatar">
        <img [src]="user.avatarURL" alt="" />
      </div>

      <div class="my-page__body" *ngIf="currentUser$ | async as currentUser">
        <p class="my-page__name">{{ user.name }}</p>
        <div class="my-page__flex">
          <mat-icon class="my-page__icon">supervised_user_circle</mat-icon>
          <p
            class="my-page__flex-item"
            (click)="openFollowersDialog(currentUser)"
          >
            フォロワー <span>{{ user.followerCount }}人</span>
          </p>
          <a
            class="my-page__flex-item my-page__flex-item--sp"
            routerLink="followers"
          >
            フォロワー <span>{{ user.followerCount }}人</span>
          </a>
          <mat-icon class="my-page__icon">supervised_user_circle</mat-icon>
          <p
            class="my-page__flex-item"
            (click)="openFollowingsDialog(currentUser)"
          >
            フォロー中 <span>{{ user.followingCount }}人</span>
          </p>
          <p
            class="my-page__flex-item my-page__flex-item--sp"
            routerLink="followings"
          >
            フォロー中 <span>{{ user.followingCount }}人</span>
          </p>
        </div>
        <p class="my-page__description">{{ user.description }}</p>
        <ng-container *ngIf="user.uid !== currentUserUid">
          <button
            mat-button
            *ngIf="!isFollowing"
            class="my-page__follow-button"
            (click)="follow()"
          >
            フォローする
          </button>
          <button
            mat-button
            *ngIf="isFollowing"
            class="my-page__following-button"
            (click)="openUnFollowDialog()"
          >
            フォロー中
          </button>
        </ng-container>
      </div>

      <div class="my-page__edit">
        <ng-container *ngIf="user.uid === currentUserUid">
          <a routerLink="/settings/profile" mat-stroked-button
            >プロフィールを編集</a
          >
        </ng-container>
      </div>
    </div>
    <p class="my-page__sp-description">{{ user.description }}</p>

    <mat-tab-group mat-align-tabs="center">
      <mat-tab label="参加イベント">
        <div class="event-grid">
          <app-event-card
            *ngFor="let event of reservedEvents$ | async"
            [event]="event"
            [uid]="user.uid"
          >
            ></app-event-card
          >
        </div>
      </mat-tab>

      <mat-tab label="主催イベント">
        <div class="event-grid">
          <app-event-card
            *ngFor="let event of ownerEvents$ | async"
            [event]="event"
            [uid]="user.uid"
            [type]="'owner'"
          >
            ></app-event-card
          >
        </div>
      </mat-tab>

      <mat-tab label="過去のイベント">
        <div class="event-grid">
          <app-event-card
            *ngFor="let event of pastEvents$ | async"
            [event]="event"
            [uid]="user.uid"
            [type]="'past'"
          >
          </app-event-card>
        </div>
      </mat-tab>

      <mat-tab label="ミーティング">
        <ng-container *ngIf="invites$ | async as invites; else empty">
          <ul>
            <li *ngFor="let invite of invites">
              <p>
                {{
                  invite.sender.name
                }}さんからミーティングの招待が届いています({{
                  invite.createdAt.toMillis() | date: 'yyyy/MM/dd HH:mm'
                }})
              </p>
              <a mat-button [routerLink]="'/meeting/' + invite.roomId"
                >参加する</a
              >
            </li>
          </ul>
        </ng-container>

        <ng-template #empty>招待はありません</ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>
</section>
